!!! 5
%html
  %head
    %title New York Times Grapher
    %link{:href => "/stylesheets/base.css", :media => "screen", :rel => "stylesheet", :type => "text/css"}
    %script{:src => 'https://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js'}
    %script{:src => '/javascript/tg.js'}
    :javascript
      $(document).ready(function () {
        TG.overlay.init();
        TG.articles.setUpHandlers();
      });
  %body{:class => body_class(params)}
    %header
      %h1
        %a{:href => '/'}
          TimesGrapher
          %span Compare the New York Times&rsquo; coverage of any two topics in a given year. 
    %div.container
      %form
        %fieldset
          %input{:type => 'text', :name => 'search1', :placeholder => 'Enter a topic', :value => params[:search1]}
          %input{:type => 'text', :name => 'search2', :placeholder => 'Enter a second topic', :value => params[:search2]}
          %select{:name => "year"}
            -(2011).downto(1981) do |i|
              -if "#{i}" == "#{@year}"
                %option{:value => "#{i}", :selected => 'selected'} #{i}
              -else
                %option{:value => "#{i}"} #{i}
          %input{:type => 'submit', :value => 'Submit'}
          %a{:href => '/', :class => 'clear'} clear
      -if params[:search1]
        %h2= "In <em>#{@year}</em>, the New York Times published <em>#{format_num(@overall_total)} articles</em> containing <em>#{@queries[0]}</em> or <em>#{@queries[1]}</em>."
        %ul.graphs
          -@totals.each_with_index do |total, index|
            %li
              %div{:style => "width:#{get_percent(total, @overall_total)}%;"}
              %p= "#{total} articles (#{get_percent(total, @overall_total)}% of #{format_num(@overall_total)}) containing \"#{@queries[index]}\""
        %div.graph
          %ul.bars
            -@totals.each_with_index do |total, index|
              %li{:style => "height:#{get_percent(total, @overall_total)}%;", :class => "bar-#{index}"}
                %a{:href => "#", :title => "Browse articles", :"data-role" => "overlay-trigger", :"data-overlay" => "div.search#{index + 1}"} #{format_num(total)}
          %ul.labels
            -@totals.each_with_index do |total, index|
              %li{:class => "label-#{index}"}
                = "#{@queries[index]}"
          %ul.y-axis
            -get_factors(@overall_total, 6).each_with_index do |factor, index|
              %li{:class => "label-#{index}"}
                #{format_num(factor)}
      -if params[:search1]
        %div.search.search1.overlay
          = partial :article_list, search: params[:search1], results: @full_data[0]['results'], class_name: '', offset: 0
        %div.search.search2.overlay
          = partial :article_list, search: params[:search2], results: @full_data[1]['results'], class_name: '', offset: 0
    %div.overlay.about
      %p
        TimesGrapher utilizes the
        %a{:target => "_blank", :href => "http://developer.nytimes.com/docs/read/article_search_api"} New York Times' articles API.
      %p
        It's built on
        %a{:target => "_blank", :href => "http://www.sinatrarb.com/"} Sinatra
        and uses
        %a{:target => "_blank", :href => "http://haml-lang.com/"} haml
        and
        %a{:target => "_blank", :href => "http://sass-lang.com/"} sass.
      %p It is not affiliated with the New York Times.
      %p
        View its source code on
        %a{:target => "_blank", :href => "http://github.com/mdb/times_grapher"} Github.
      %p
        &copy; 2012
        %a{:target => "_blank", :href => "http://mikeball.us"} MDB
    %div#overlay-mask
    %footer
      %ul
        %li
          &copy; 2012
          %a{:target => "_blank", :href => "http://mikeball.us"} MDB
        %li
          %a{:target => "_blank", :href => "http://github.com/mdb/times_grapher"} Source Code
        %li
          %a{:"data-role" => "overlay-trigger", :"data-overlay" => ".about", :href => "#"} About
        %li
          Not affiliated with the New York Times
